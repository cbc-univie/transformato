* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v3.5 on Aug, 17. 2021. JOBID=2920866270
* INPUT FILE FOR NPT DYNAMICS OF SOLVATED GLOBULAR PROTEIN
*

DIMENS CHSIZE 5000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

! Read PSF and Coordinates

! Please set cnt on the command line like this: $charmm cnt=$cnt -i step7_production.inp -o step7_production_${cnt}.out
if @?cnt .eq. 0 stop  ! Error: missing value for cnt

open read unit 10 card name ../step3_pbcsetup.psf
read psf  unit 10 card
open read unit 10 card name ../step3_pbcsetup.crd
read coor unit 10 card
!
! Setup PBC (Periodic Boundary Condition)
!

stream ../step3_pbcsetup.str

!
! Previous box information
!

calc pcnt = @cnt - 1
if pcnt .gt. 0 then
    bomlev -5
    open read  unit 11 card name step5_@pcnt.rst
    read coor dynr curr unit 11
    bomlev  0

    calc A = ?XTLA
    calc B = ?XTLB
    calc C = ?XTLC
endif

!
! Image Setup
!

open read unit 10 card name ../crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
calc xcen = @A / 2
calc ycen = @B / 2
calc zcen = @C / 2
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele segid IONS end

!
! Nonbonded Options
!

omm on

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
! NPT dynamics:
! you can change
! nstep  : number of MD steps
! nprint : print-out frequency
! nsavc  : the trajectory saving frequency
!

set nstep = 500000

set temp = 303.15
shake bonh param fast

calc pcnt = @cnt - 1
if pcnt .eq. 0 open read  unit 11 card name step4_equilibration.rst
if pcnt .gt. 0 open read  unit 11 card name step5_@pcnt.rst
open write unit 12 card name step5_@cnt.rst
open write unit 13 file name step5_@cnt.dcd

DYNA CPT leap restart time 0.002 nstep @nstep -
     nprint 1000 iprfrq 1000 ntrfrq 1000 -
     iunread 11 iunwri 12 iuncrd 13 iunvel -1 kunit -1 -
     nsavc 50000 nsavv 0 -
     omm langevin gamma 10 firstt @temp finalt @temp -
     prmc pref 1.0 iprsfrq 15

open write unit 10 card name step5_@cnt.pdb
write coor unit 10 pdb
close unit 10

open write unit 10 card name step5_@cnt.crd
write coor unit 10 card
close unit 10

stop

