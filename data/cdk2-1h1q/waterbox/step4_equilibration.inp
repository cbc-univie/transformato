* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v3.5 on Aug, 12. 2021. JOBID=2875961067
* INPUT FILE FOR EQUILIBRATION OF SOLVATED GLOBULAR PROTEIN
* 

DIMENS CHSIZE 5000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

! Read PSF
open read unit 10 card name step3_pbcsetup.psf
read psf  unit 10 card

!Read Coordinate
open read unit 10 card name step3_pbcsetup.crd
read coor unit 10 card

!
! Setup PBC (Periodic Boundary Condition)
!

stream step3_pbcsetup.str

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD


!Image centering by residue
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele segid IONS end

!
! Nonbonded Options
!

nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
!use positional restraints for equilibration
![you can change the force constant and run longer equilibration (at least 100-200 ps)]
!

define PROT sele none end
define CARB sele none end
define HETE sele ( segid HETA ) end

define BB   sele ( ( type C   .or. type O   .or. type N   .or. type CA  .or. -
                     type P   .or. type O1P .or. type O2P .or. type O5' .or. -
                     type C5' .or. type C4' .or. type C3' .or. type O3' ) .and. PROT ) .or. -
                 ( ( type C+ .or. ( type O5 .and. .bonded. type C1 ) .or. ( type O6 .and. .bonded. type C2 ) ) .and. CARB ) .or. -
                 ( .not. hydrogen .and. HETE ) end
define SC   sele .not. BB .and. .not. hydrogen .and. ( PROT .or. CARB ) end

cons harm force 1.0 sele BB end
cons harm force 0.1 sele SC end

mini SD   nstep 50 nprint 5
mini ABNR nstep 50 nprint 5

!
! NVT dynamics,
! you can change
! nstep  : number of MD steps
! nprint : print-out frequency
! NOTE:
! The integration time step (timestep) is set to 1 fs only for equilibration
! to avoid any unstable dynamics and thus abnormal termination.
! However, it might be possible to increase it to 2 fs in most applications.
!

set nstep = 125000
set temp = 303.15

shake bonh param fast

open write unit 12 card name step4_equilibration.rst

DYNA VVER start timestep 0.001 nstep @nstep -
     nprint 1000 iprfrq 1000 ntrfrq 1000 -
     iunread -1 iunwri 12 iuncrd -1 iunvel -1 kunit -1 -
     nsavc 0 nsavv 0 -
     nose rstn tref @temp qref 50 ncyc 10 firstt @temp

open write unit 10 card name step4_equilibration.pdb
write coor unit 10 pdb

open write unit 10 card name step4_equilibration.crd
write coor unit 10 card
close unit 10

stop
