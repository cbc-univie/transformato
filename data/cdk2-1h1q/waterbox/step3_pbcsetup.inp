* GENERATED BY CHARMM-GUI (http://www.charmm-gui.org) v3.5 on Aug, 12. 2021. JOBID=2875961067
* SETUP PERIODIC BOUNDARY CONDITION 
* 

DIMENS CHSIZE 5000000 MAXRES 3000000

! Read topology and parameter files
stream toppar.str

!Read PSF and Coordinates 
open read unit 10 card name step1_pdbreader.psf
read psf  unit 10 card


stream step2_solvator.str

open read unit 10 card name step2_solvator.psf
read psf  unit 10 card

open read unit 10 card name step2_solvator.crd
read coor unit 10 card


!
! Setup PBC (Periodic Boundary Condition)
!

stream step2.1_waterbox.prm

COOR CONVERT ALIGNED SYMMETRIC @A @B @C @alpha @beta @gamma

open read unit 10 card name crystal_image.str
CRYSTAL DEFINE @XTLtype @A @B @C @alpha @beta @gamma
CRYSTAL READ UNIT 10 CARD

!Image centering by residue
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele resname TIP3 end
IMAGE BYRESID XCEN @xcen YCEN @ycen ZCEN @zcen sele segid IONS end

!
! Nonbonded Options
!

system "python checkfft.py ?XTLA ?XTLB ?XTLC > checkfft.str"
stream checkfft.str


nbonds atom vatom vfswitch bycb -
       ctonnb 10.0 ctofnb 12.0 cutnb 16.0 cutim 16.0 -
       inbfrq -1 imgfrq -1 wmin 1.0 cdie eps 1.0 -
       ewald pmew fftx @fftx ffty @ffty fftz @fftz  kappa .34 spline order 6
energy

!
! cons fix all heavy atoms except generated water molecules and 
! short minimization
!

cons fix sele .not. ( hydrogen .or. segid SOLV .or. segid IONS ) end
cons harm force 0.1 sele segid IONS end

mini SD   nstep 50 nprint 5
mini ABNR nstep 50 nprint 5

cons fix sele none end


!
! Write coordinates and system information
!

open write unit 10 card name step3_pbcsetup.psf
write  psf unit 10 card

open write unit 10 card name step3_pbcsetup.oldpsf
write  psf unit 10 card oldpsf

open write unit 10 card name step3_pbcsetup.pdb
write coor unit 10 pdb  

open write unit 10 card name step3_pbcsetup.crd
write coor unit 10 card

open  write unit 90 card name step3_pbcsetup.str
write title unit 90
* set BoxType  = @BoxType
* set XTLtype  = @XTLtype
* set A = @A
* set B = @B
* set C = @C
* set Alpha = @Alpha
* set Beta  = @Beta
* set Gamma = @Gamma
* set fftx  = @fftx
* set ffty  = @ffty
* set fftz  = @fftz
* set xcen  = @xcen
* set ycen  = @ycen
* set zcen  = @zcen
*


stop
